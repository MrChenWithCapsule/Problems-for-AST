# 第八周脑力风暴答案

不知上期的题目有没有让在座各位大佬过把瘾  
第一次出相对较难的题目我们也很忐忑，不知反响会如何  
所以看官们如果有什么意见一定要向我们提呀，有了诸位的参与我们的模块才能越办越好  
那话不多说，待我们暴力拆解上期小题


## 题目一：不那么简单的微积分

上期微积分有一定难度，严谨起见，便直接附上专业解答

$f(x)$ 为抽象函数，由题设条件可知，只能考虑极限定义。

1. 设 
    $\lim_{x\rightarrow+\infty} [f(x+1)-f(x)] = A$ 。  
    任给 $\epsilon>0$，由极限定义可知必定存在正数 $X_0>a$，当 $x\ge X_0$ 时，总有
    $$|f(x+1)-f(x)-A|<\frac \epsilon 3。$$  
    设$x>X_0+1$，于是必定存在正整数$n$，使
    $$n \le x-X_0 < x+1，$$  
    令 $\tau = x-X_0-n$，则 $0\le\tau < 1，x=X_0+\tau+n$ 。  
    $$\frac {f(x)} x - A = \frac n x [\frac {f(x)-f(X_0+\tau)} n -A] + \frac {f(X_0 + \tau)} x -\frac {X_0+\tau} x A。$$  
    由于 $n<x$ ，可知
    $$|\frac n x [\frac {f(x)-f(X_0+\tau)} n -A]|\le |\frac {f(X_0+\tau+n)-f(X_0+\tau)} n -A|$$  
    $$= \frac 1 n |\sum_{k=1}^n [f(X_0+\tau+k)-f(X_0+\tau+k-1)-A]|$$  
    $$\le \frac 1 n \sum_{k=1}^n|f(X_0+\tau+k)-f(X_0+\tau+k-1)-A|$$  
    $$\le \frac 1 n \cdot \frac {n\epsilon} 3 = \frac \epsilon 3。$$  
    由题设知 $f(x)$ 在 $X_0\le x < X_0 +1$ 上有界，故存在正数 $X_1$ ，当 $x>X_1$ 时，总有
    $$|\frac {f(X_0+\tau)} x|<\frac \epsilon 3。$$  
    同样存在正数 $X_2$ ，当 $x>X_2$ 时，总有
    $$|\frac {(X_0+1)A} x|<\frac \epsilon 3，$$  
    令 $X=\max{\{X_0+1,X_1,X_2\}}$ ，可知当 $x>X$ 时，必有
    $$|\frac {f(x)} x -A| < \frac \epsilon 3 + \frac \epsilon 3 + \frac \epsilon 3 = \epsilon，$$  
    故
    $$\lim_{x\rightarrow+\infty} \frac {f(x)} x = A。$$

2. 设 $\lim_{x\rightarrow+\infty}{[f(x+1)-f(x)]} = +\infty$ 。  
    任给 $G>0$ ，必存在正数 $X_0>a$， 使 $x\ge X_0$ 时，总有 $f(x+1)-f(x)>4G$ 。  
    设 $x>2(X_0+1)$ ，可知存在正整数 $n$ ，满足
    $$n \le x - X_0 < n+1。$$  
    令 $\tau = x - X_0 - n$ ，则 $0\le \tau < 1。 x=X_0 + \tau + n$ 。由于 $x+1>x-X_0>X_0+2$ ，故 $x>X_0+1>X_0+\tau$ ，从而 $2n>x$ ， 即
    $$\frac n x > \frac 1 2。$$  
    由于
    $$\frac {f(x)} x = \frac n x \cdot \frac {f(x)-f(X_0+\tau)} n + \frac {f(X_0+\tau)} x，$$  
    $$\frac {f(x)-f(X_0+\tau)} n = \frac 1 n \sum_{k=1}^n [f(X_0+\tau+k)-f(X_0+\tau+k-1)]$$  
    $$>\frac 1 n \cdot 4nG = 4G。$$  
    因此
    $$\frac n x \cdot \frac {f(x)-f(X_0+\tau)} n > 2G。$$  
    由题设 $f(x)$ 在 $X_0<x<X_0+1$ 上上有界，故存在正数 $X_1$ ，当 $x>X_1$ 时，总有
    $$|\frac {f(X_0+\tau)} x|<G。$$  
    故知
    $$\lim_{x\rightarrow+\infty} = +\infty。$$  
    相仿可知，当 $\lim_{x\rightarrow+\infty} {[f(x+1)-f(x)]} = -\infty$ 时，有 $\lim_{x\rightarrow+\infty} {\frac {f(x)} x} = -\infty$

原题上本没有“假设等式两侧极限均存在或无穷大”这个条件，但是我令 $f(x)=\sin x$ 时出现了bug。。。  
无奈之下我才加了这个条件，不过我自己很懵，所以如果有大佬明白这是怎么回事的话欢迎私戳学术墙教教我这个渣渣。

## 题目二：愤怒的小鸟

（据某些同学说这次的题看不懂。。。我的错，我以后再也不会赶工了。）

### 首先是各种解法跑的时间

|       n        |  1000   |  2000  |  3000  |
| :------------: | :-----: | :----: | :----: |
|    $O(n^3)$    | 0.585s  | 4.684s | 14.85s |
| $O(n^2\log n)$ | 0.135s  | 0.78s  | 1.912s |
|    $O(n^2)$    | 0.0875s | 0.522s | 1.116s |

注：
这是我在自己的渣电脑的 WSL 上跑的，编译参数为 g++ -Ofast ，大家跑的时间应该会比这个少。  
所用数据为测试数据中相应 $n$ 的数据，结果为各个数据取平均值得到。

（我没找到办法把 $O(n^2)$ 版本的时间压进一秒，有哪位 dailao 愿意帮帮我吗？）

### 简单难度解法

其实这道题的解法相对来说还是很好想的，只是涉及到浮点数的处理非常烦人。

简单难度我想到了两种解法，这里主要说其中一种，另一种只简单提一下。  
假设两只小猪的坐标分别为 $(x_1, y_1)， (x_2, y_2)$ 由此我们可以算出经过他们的抛物线参数 $a， b$  
每两只小猪都可以算出这样一对 $a， b$ ，显然如果两对小猪算出的 $a， b$ 相等，那么他们就在同一条抛物线上。  
而我们需要遍历两次，第一次算出 $a， b$ ，第二次进行比较，这样就可以确定最多一次可以打到多少只小猪了。

下面说一些细节。  

1. 浮点数的处理

    由于精度的影响，两对本来在同一直线上的小猪算出来的 $a， b$ 可能有微小差异，这时如果直接比较就会得到不相等的结果。为了处理这种情况，我们引入一个比较小的误差值。  
    误差值可以是绝对误差或相对误差。理论上对于浮点数使用相对误差更好，但为了简便我使用了绝对误差。当 $|a-b|<\delta$ 时，我们就认为 $a， b$ 相等。这里的 $\delta$ 参考实现取的是 $10^{-6}$ ，但就这几组测试数据而言，只要取 $10^{-4}\le\delta\le10^{-7}$ 就可以过。

2. $a， b$ 的计算

    设抛物线 $y=ax^2+bx$ 过 $(x_1, y_1)， (x_2, y_2)$ 两点，我们可以解得：
    $$a=\frac {x_2y_1-x_1y_2} {x_1^2x_2-x_1x_2^2}， b=\frac {x_1^2y_2-x_2^2y_1} {x_1^2x_2 - x_1x_2^2}$$

3. 两只小猪 $x$ 坐标相等时的处理

    由于要求 $a<0$ ，及抛物线开口向下，我们这时把这条抛物线的 $a$ 赋值为任意一个大于 $0$ 的数，之后计算时就会被忽略掉了。

4. 关于数据范围

    虽然这种解法是 $O(n^3)$ 的，但是由于某些非常强的判断条件（我说的是 $a\ge0$），使得这种方法在 $n\le1000$ 时也可以在一秒内跑完。之前题目给出的 $n\le300$ 是通常而言一个 $O(n^3)$ 的算法在一秒内可以跑的数据规模。（因为当时我连答案都还没写就只有凭经验。。。）

至于另外一种方法，就是先算出一条抛物线再每个点带入方程验证是否在这条抛物线上。这种方法也是 $O(n^3)$ 的时间复杂度，具体哪种更快我也没试过。

### 复杂难度解法

之前提到我们需要把经过每一对小猪的抛物线计算出来，这时我们只需要把这个抛物线存入一个 std::map 中，然后看其中哪个抛物线出现得最多即可。这种方法时间复杂度是 $O(n^2\log n)$ ，可以处理 $n\le 2000$ 的数据。  
注意到这里需要用一个结构体来存储一组的 $a， b$ ，并且需要重载小于运算符才能放进 std::map 中。同时需要注意，假设某条抛物线上的小猪有 $n$ 只，这里的 std::map 里的结果等于 $\frac{n(n-1)}{2}$ ，即两两成对的对数，因此需要由对数反过来算出只数。至于具体怎么做可以去看参考实现。

### 不可能难度解法

我们只需要把 std::map 换成 std::unordered_map 就行了，当然这时要写哈希函数并重载等于运算符。具体实现同样见源码。

严格来说这并不是一种正确的方法。至于错在哪里我就不说了。😂  
如果有哪位 dailao 可以想出另一种 $O(n^2)$ 的方法欢迎在学术交流群里分享。

### 注

- 参考实现的简单难度是用纯 C 实现的，复杂难度为 C++98 ，不可能难度为 C++11。后两种可能需要了解一些额外知识才能看懂源码。
- 测试数据中，D*.txt 为手算级别（Debug 用），E*.txt 为简单难度，H*.txt 为复杂难度，I*.txt 为不可能难度，请注意 $n$ 的大小以防溢出。


感谢看到这里的你～
